<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Disease Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="page-background"></div>
    <div class="floating-elements"></div>
    <div class="content-wrapper">
        <div class="container">
            <header class="text-center py-4">
                <h1><i class="fas fa-heartbeat text-danger"></i> Heart Disease Prediction System</h1>
                <p class="lead">Enter your health parameters to assess heart disease risk</p>
            </header>

        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow">
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="row">
                                <!-- Basic Information -->
                                <div class="col-md-6 mb-3">
                                    <h5 class="text-primary"><i class="fas fa-user"></i> Basic Information</h5>
                                    
                                    <div class="mb-3">
                                        <label for="age" class="form-label age-label">Age</label>
                                        <input type="number" class="form-control" id="age" name="age" min="1" max="120" required>
                                        <div class="form-text">Age in years</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="sex" class="form-label sex-label">Sex</label>
                                        <select class="form-select" id="sex" name="sex" required>
                                            <option value="">Select Sex</option>
                                            <option value="1">Male</option>
                                            <option value="0">Female</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Chest Pain Type -->
                                <div class="col-md-6 mb-3">
                                    <h5 class="text-warning"><i class="fas fa-lungs"></i> Chest Pain Type</h5>
                                    
                                    <div class="mb-3">
                                        <label for="cp" class="form-label cp-label">Chest Pain Type</label>
                                        <select class="form-select" id="cp" name="cp" required>
                                            <option value="">Select Type</option>
                                            <option value="0">Typical Angina</option>
                                            <option value="1">Atypical Angina</option>
                                            <option value="2">Non-anginal Pain</option>
                                            <option value="3">Asymptomatic</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="exang" class="form-label exang-label">Exercise Induced Angina</label>
                                        <select class="form-select" id="exang" name="exang" required>
                                            <option value="">Select</option>
                                            <option value="0">No</option>
                                            <option value="1">Yes</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Blood Pressure and Cholesterol -->
                                <div class="col-md-6 mb-3">
                                    <h5 class="text-info"><i class="fas fa-tachometer-alt"></i> Vitals</h5>
                                    
                                    <div class="mb-3">
                                        <label for="trestbps" class="form-label trestbps-label">Resting Blood Pressure</label>
                                        <input type="number" class="form-control" id="trestbps" name="trestbps" min="80" max="200" required>
                                        <div class="form-text">mm Hg</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="chol" class="form-label chol-label">Serum Cholesterol</label>
                                        <input type="number" class="form-control" id="chol" name="chol" min="100" max="600" required>
                                        <div class="form-text">mg/dl</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="thalach" class="form-label thalach-label">Maximum Heart Rate Achieved</label>
                                        <input type="number" class="form-control" id="thalach" name="thalach" min="60" max="220" required>
                                        <div class="form-text">bpm</div>
                                    </div>
                                </div>

                                <!-- Medical Test Results -->
                                <div class="col-md-6 mb-3">
                                    <h5 class="text-success"><i class="fas fa-stethoscope"></i> Medical Tests</h5>
                                    
                                    <div class="mb-3">
                                        <label for="fbs" class="form-label fbs-label">Fasting Blood Sugar > 120 mg/dl</label>
                                        <select class="form-select" id="fbs" name="fbs" required>
                                            <option value="">Select</option>
                                            <option value="0">False</option>
                                            <option value="1">True</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="restecg" class="form-label restecg-label">Resting ECG Results</label>
                                        <select class="form-select" id="restecg" name="restecg" required>
                                            <option value="">Select Result</option>
                                            <option value="0">Normal</option>
                                            <option value="1">ST-T wave abnormality</option>
                                            <option value="2">Left ventricular hypertrophy</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="oldpeak" class="form-label oldpeak-label text-primary">ST Depression (oldpeak)</label>
                                        <input type="number" class="form-control" id="oldpeak" name="oldpeak" min="0" max="10" step="0.1" required>
                                        <div class="form-text">Exercise induced ST depression</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Additional Parameters -->
                                <div class="col-md-6 mb-3">
                                    <h5 class="text-secondary"><i class="fas fa-chart-line"></i> Additional Parameters</h5>
                                    
                                    <div class="mb-3">
                                        <label for="slope" class="form-label slope-label text-success">Peak Exercise ST Segment</label>
                                        <select class="form-select" id="slope" name="slope" required>
                                            <option value="">Select Slope</option>
                                            <option value="0">Upsloping</option>
                                            <option value="1">Flat</option>
                                            <option value="2">Downsloping</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="ca" class="form-label ca-label">Number of Major Vessels</label>
                                        <select class="form-select" id="ca" name="ca" required>
                                            <option value="">Select Count</option>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="thal" class="form-label thal-label">Thalassemia</label>
                                        <select class="form-select" id="thal" name="thal" required>
                                            <option value="">Select Type</option>
                                            <option value="1">Normal</option>
                                            <option value="2">Fixed Defect</option>
                                            <option value="3">Reversible Defect</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-heartbeat"></i> Predict Heart Disease Risk
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultSection" class="result-separte mt-4" style="display: none;">
                    <div class="card-body">
                        <h4 class="card-title text-center">
                            <i class="fas fa-clipboard-check"></i> Prediction Results
                        </h4>
                        <div id="resultContent"></div>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Analyzing your health parameters...</p>
                </div>
            </div>
        </div>

        <!-- Information Section -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-info-circle"></i> About This System</h5>
                        <p class="card-text">
                            This heart disease prediction system uses machine learning to analyze your health parameters 
                            and assess the risk of heart disease. The model is trained on medical data and provides 
                            predictions based on patterns learned from thousands of patient records.
                        </p>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Disclaimer:</strong> This system is for educational purposes only and should not 
                            be used as a substitute for professional medical advice. Always consult with a qualified 
                            healthcare provider for medical concerns.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <footer class="footer-visible">
        <div class="container">
            <p>&copy; 2026 Heart Disease Prediction System. All rights reserved From Government.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Enhanced scroll-based parallax effect
        let ticking = false;
        let lastScrollY = 0;
        let scrollDirection = 'down';
        let scrollSpeed = 0;
        let lastScrollTime = Date.now();
        
        function updateParallax() {
            const scrollY = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const scrollPercentage = (scrollY / (documentHeight - windowHeight)) * 100;
            
            // Calculate scroll speed and direction
            const currentTime = Date.now();
            const timeDiff = currentTime - lastScrollTime;
            const scrollDiff = Math.abs(scrollY - lastScrollY);
            scrollSpeed = timeDiff > 0 ? scrollDiff / timeDiff : 0;
            scrollDirection = scrollY > lastScrollY ? 'down' : 'up';
            lastScrollTime = currentTime;
            
            // Enhanced background parallax with multiple layers
            const pageBackground = document.querySelector('.page-background');
            const floatingElements = document.querySelector('.floating-elements');
            
            if (pageBackground) {
                // Main background layer - slowest
                pageBackground.style.transform = `translateY(${scrollY * 0.3}px) scale(${1 + scrollPercentage * 0.001})`;
            }
            
            if (floatingElements) {
                // Floating elements - medium speed
                floatingElements.style.transform = `translateY(${scrollY * 0.5}px) rotate(${scrollPercentage * 0.5}deg)`;
                
                // Update floating orbs based on scroll
                const orb1 = floatingElements.querySelector('.floating-orb-1');
                const orb2 = floatingElements.querySelector('.floating-orb-2');
                
                if (orb1) {
                    orb1.style.transform = `translate(${scrollY * 0.2}px, ${scrollY * 0.1}px) scale(${1 + Math.sin(scrollPercentage * 0.1) * 0.3})`;
                }
                if (orb2) {
                    orb2.style.transform = `translate(${-scrollY * 0.15}px, ${scrollY * 0.25}px) scale(${1 + Math.cos(scrollPercentage * 0.1) * 0.3})`;
                }
            }
            
            // Dynamic body pseudo-elements
            document.documentElement.style.setProperty('--scroll-y', `${scrollY}px`);
            document.documentElement.style.setProperty('--scroll-percentage', `${scrollPercentage}%`);
            document.documentElement.style.setProperty('--scroll-speed', `${scrollSpeed}`);
            document.documentElement.style.setProperty('--scroll-direction', scrollDirection);
            
            // Update scroll indicator
            updateScrollIndicator(scrollPercentage);
            
            // Add dynamic effects based on scroll position
            addDynamicEffects(scrollPercentage, scrollSpeed);
            
            lastScrollY = scrollY;
            ticking = false;
        }
        
        function requestTick() {
            if (!ticking) {
                window.requestAnimationFrame(updateParallax);
                ticking = true;
            }
        }
        
        function updateScrollIndicator(percentage) {
            const scrollIndicator = document.querySelector('.scroll-indicator');
            if (scrollIndicator) {
                scrollIndicator.style.height = `${Math.min(percentage, 100)}%`;
                scrollIndicator.style.opacity = '0.8';
            }
        }
        
        function addDynamicEffects(percentage, speed) {
            // Add pulse effect to main container based on scroll speed
            const mainContainer = document.querySelector('.main-container');
            if (mainContainer && speed > 0.5) {
                mainContainer.style.boxShadow = `0 ${20 + speed * 10}px ${40 + speed * 20}px rgba(0, 0, 0, ${0.1 + speed * 0.05})`;
            }
            
            // Change header opacity based on scroll
            const headerSection = document.querySelector('.header-section');
            if (headerSection) {
                const opacity = Math.max(0.7, 1 - percentage * 0.005);
                headerSection.style.opacity = opacity;
            }
            
            // Add floating particles effect
            if (Math.random() < 0.02 && speed > 0.3) {
                createFloatingParticle();
            }
        }
        
        function createFloatingParticle() {
            const particle = document.createElement('div');
            particle.className = 'scroll-particle';
            particle.style.cssText = `
                position: fixed;
                width: ${Math.random() * 4 + 2}px;
                height: ${Math.random() * 4 + 2}px;
                background: rgba(79, 172, 254, ${Math.random() * 0.5 + 0.3});
                border-radius: 50%;
                top: ${Math.random() * window.innerHeight}px;
                left: ${Math.random() * window.innerWidth}px;
                z-index: 1000;
                pointer-events: none;
                animation: particleFloat ${Math.random() * 2 + 1}s ease-out forwards;
            `;
            
            document.body.appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 3000);
        }
        
        // Enhanced scroll event listeners
        window.addEventListener('scroll', requestTick);
        window.addEventListener('resize', requestTick);
        
        // Remove mouse wheel prevention - allow natural scrolling
        // window.addEventListener('wheel', (e) => {
        //     e.preventDefault();
        //     const delta = e.deltaY;
        //     window.scrollBy({
        //         top: delta,
        //         behavior: 'smooth'
        //     });
        // }, { passive: false });
        
        // Touch support for mobile (enhanced but not preventing default)
        let touchStartY = 0;
        window.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });
        
        window.addEventListener('touchmove', (e) => {
            // Allow natural touch scrolling, just track for effects
            const touchY = e.touches[0].clientY;
            const deltaY = touchStartY - touchY;
            touchStartY = touchY;
        });
        
        // Initialize on load
        window.addEventListener('load', () => {
            updateParallax();
            createScrollIndicator();
            addEnhancedBackgroundElements();
        });
        
        function createScrollIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'scroll-indicator';
            indicator.innerHTML = '<i class="fas fa-chevron-up"></i>';
            document.body.appendChild(indicator);
        }
        
        function addEnhancedBackgroundElements() {
            // Add additional floating orbs
            const floatingElements = document.querySelector('.floating-elements');
            if (floatingElements) {
                const orb1 = document.createElement('div');
                orb1.className = 'floating-orb-1';
                orb1.style.cssText = `
                    position: absolute;
                    top: 10%;
                    left: 10%;
                    width: 80px;
                    height: 80px;
                    background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
                    border-radius: 50%;
                    animation: float1 8s ease-in-out infinite;
                `;
                
                const orb2 = document.createElement('div');
                orb2.className = 'floating-orb-2';
                orb2.style.cssText = `
                    position: absolute;
                    top: 60%;
                    right: 15%;
                    width: 120px;
                    height: 120px;
                    background: radial-gradient(circle, rgba(79, 172, 254, 0.12) 0%, transparent 70%);
                    border-radius: 50%;
                    animation: float2 10s ease-in-out infinite;
                `;
                
                floatingElements.appendChild(orb1);
                floatingElements.appendChild(orb2);
            }
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    window.scrollBy({ top: -100, behavior: 'smooth' });
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    window.scrollBy({ top: 100, behavior: 'smooth' });
                    break;
                case 'Home':
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    break;
                case 'End':
                    e.preventDefault();
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    break;
            }
        });
        
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading spinner
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            
            // Get form data
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // Hide loading spinner
                document.getElementById('loadingSpinner').style.display = 'none';
                
                if (result.error) {
                    showError(result.error);
                } else {
                    showResult(result);
                }
                
            } catch (error) {
                document.getElementById('loadingSpinner').style.display = 'none';
                showError('Error connecting to server: ' + error.message);
            }
        });
        
        function showResult(result) {
            const resultContent = document.getElementById('resultContent');
            
            let html = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card result-card">
                            <div class="card-header ${result.risk_level.toLowerCase()}">
                                <h5><i class="fas fa-${result.risk_level === 'High' ? 'exclamation-triangle' : 'check-circle'}"></i> ${result.result}</h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <h4>Risk Level: <span class="badge bg-${result.risk_level === 'High' ? 'danger' : 'success'}">${result.risk_level}</span></h4>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Confidence:</span>
                                        <span class="badge bg-primary">${result.confidence}%</span>
                                    </div>
                                    <div class="progress confidence-bar">
                                        <div class="confidence-fill ${result.risk_level.toLowerCase()}" style="width: ${result.confidence}%"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-chart-pie"></i> Probability</h6>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>High Risk:</span>
                                            <span class="badge bg-danger">${result.probability_high_risk}%</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Low Risk:</span>
                                            <span class="badge bg-success">${result.probability_low_risk}%</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-info-circle"></i> Details</h6>
                                        <ul class="list-unstyled">
                                            <li><strong>Prediction:</strong> ${result.prediction === 1 ? 'Heart Disease Detected' : 'No Heart Disease'}</li>
                                            <li><strong>Model:</strong> ${result.model_type}</li>
                                            <li><strong>Features Used:</strong> ${result.features ? result.features.length : 0}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add feature importance if available
            if (result.feature_importance && Object.keys(result.feature_importance).length > 0) {
                html += `
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info">
                                <h5><i class="fas fa-chart-bar"></i> Feature Importance</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                `;
                
                // Sort features by importance
                const sortedFeatures = Object.entries(result.feature_importance)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                sortedFeatures.forEach(([feature, importance]) => {
                    html += `<li><strong>${feature}:</strong> <span class="badge bg-secondary">${(importance * 100).toFixed(1)}%</span></li>`;
                });
                
                html += `
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += `
                    <div class="alert alert-${result.risk_level === 'High' ? 'danger' : 'success'}">
                        <i class="fas fa-${result.risk_level === 'High' ? 'exclamation-triangle' : 'check-circle'}"></i>
                        <strong>${result.risk_level === 'High' ? 'Important:' : 'Good News:'}</strong> 
                        ${result.risk_level === 'High' ? 
                            'Your health parameters indicate a higher risk of heart disease. Please consult with a healthcare provider for proper medical evaluation.' : 
                            'Your health parameters suggest a lower risk of heart disease. Continue maintaining a healthy lifestyle.'}
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = html;
            document.getElementById('resultSection').style.display = 'block';
            
            // Enhanced smooth scroll to results
            document.getElementById('resultSection').scrollIntoView({ 
                behavior: 'smooth',
                block: 'center'
            });
            
            // Trigger celebration effect for good results
            if (result.risk_level === 'Low') {
                createCelebrationEffect();
            }
        }
        
        function createCelebrationEffect() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: fixed;
                        width: 6px;
                        height: 6px;
                        background: ${['#27ae60', '#2ecc71', '#3498db', '#9b59b6'][Math.floor(Math.random() * 4)]};
                        border-radius: 50%;
                        top: 50%;
                        left: 50%;
                        z-index: 10000;
                        pointer-events: none;
                        animation: celebrate 1s ease-out forwards;
                    `;
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }
        
        function showError(message) {
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Error:</strong> ${message}
                </div>
            `;
            document.getElementById('resultSection').style.display = 'block';
        }
        
        // Model info function
        async function getModelInfo() {
            try {
                const response = await fetch('/model_info');
                const result = await response.json();
                console.log('Model Info:', result);
            } catch (error) {
                console.error('Error getting model info:', error);
            }
        }
        
        // Load model info on page load
        getModelInfo();
    </script>
</body>
</html>
